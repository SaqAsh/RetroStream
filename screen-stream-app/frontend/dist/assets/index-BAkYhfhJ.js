!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class e{constructor(){this.events=new Map}on(e,t){this.events.has(e)||this.events.set(e,new Set),this.events.get(e).add(t)}off(e,t){const n=this.events.get(e);n&&(n.delete(t),0===n.size&&this.events.delete(e))}emit(e,t){const n=this.events.get(e);n&&n.forEach(n=>{try{n(t)}catch(r){console.error(`Error in event handler for '${String(e)}':`,r)}})}once(e,t){const n=r=>{t(r),this.off(e,n)};this.on(e,n)}removeAllListeners(e){e?this.events.delete(e):this.events.clear()}listenerCount(e){return this.events.get(e)?.size||0}hasListeners(e){return this.listenerCount(e)>0}}class t{constructor(e){this.buffer=[],this.currentIndex=0,this.maxSize=e}addFrame(e){this.buffer.push(e),this.buffer.length>this.maxSize&&this.buffer.shift(),this.currentIndex=this.buffer.length-1}getLatestFrame(){return 0===this.buffer.length?null:this.buffer[this.buffer.length-1]}getFrame(e){return e<0||e>=this.buffer.length?null:this.buffer[e]}getCurrentFrame(){return this.getFrame(this.currentIndex)}nextFrame(){return this.currentIndex<this.buffer.length-1&&this.currentIndex++,this.getCurrentFrame()}previousFrame(){return this.currentIndex>0&&this.currentIndex--,this.getCurrentFrame()}seekToLatest(){return this.currentIndex=Math.max(0,this.buffer.length-1),this.getCurrentFrame()}getBufferSize(){return this.buffer.length}getMaxSize(){return this.maxSize}clear(){this.buffer=[],this.currentIndex=0}getBufferHealth(){return this.buffer.length/this.maxSize}getOldestFrameAge(){if(0===this.buffer.length)return 0;const e=this.buffer[0];return Date.now()-e.timestamp}getLatency(){const e=this.getLatestFrame();return e&&e.metadata.latency||0}dropOldFrames(e){const t=Date.now();let n=0;for(;this.buffer.length>0&&t-this.buffer[0].timestamp>e;)this.buffer.shift(),n++;return this.currentIndex=Math.max(0,this.currentIndex-n),n}getFrameStats(){return{bufferSize:this.getBufferSize(),maxSize:this.getMaxSize(),currentIndex:this.currentIndex,oldestFrameAge:this.getOldestFrameAge(),latency:this.getLatency(),bufferHealth:this.getBufferHealth()}}}var n={},r=Uint8Array,i=Uint16Array,s=Int32Array,o=new r([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),a=new r([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),c=new r([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),l=function(e,t){for(var n=new i(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var o=new s(n[30]);for(r=1;r<30;++r)for(var a=n[r];a<n[r+1];++a)o[a]=a-n[r]<<5|r;return{b:n,r:o}},h=l(o,2),u=h.b,d=h.r;u[28]=258,d[258]=28;for(var g=l(a,0).b,f=new i(32768),m=0;m<32768;++m){var v=(43690&m)>>1|(21845&m)<<1;v=(61680&(v=(52428&v)>>2|(13107&v)<<2))>>4|(3855&v)<<4,f[m]=((65280&v)>>8|(255&v)<<8)>>1}var p=function(e,t,n){for(var r=e.length,s=0,o=new i(t);s<r;++s)e[s]&&++o[e[s]-1];var a,c=new i(t);for(s=1;s<t;++s)c[s]=c[s-1]+o[s-1]<<1;if(n){a=new i(1<<t);var l=15-t;for(s=0;s<r;++s)if(e[s])for(var h=s<<4|e[s],u=t-e[s],d=c[e[s]-1]++<<u,g=d|(1<<u)-1;d<=g;++d)a[f[d]>>l]=h}else for(a=new i(r),s=0;s<r;++s)e[s]&&(a[s]=f[c[e[s]-1]++]>>15-e[s]);return a},y=new r(288);for(m=0;m<144;++m)y[m]=8;for(m=144;m<256;++m)y[m]=9;for(m=256;m<280;++m)y[m]=7;for(m=280;m<288;++m)y[m]=8;var w=new r(32);for(m=0;m<32;++m)w[m]=5;var C=p(y,9,1),S=p(w,5,1),b=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},E=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},L=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},F=function(e){return(e+7)/8|0},x=function(e,t,n){return(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length),new r(e.subarray(t,n))},I=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],O=function(e,t,n){var r=new Error(t||I[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,O),!n)throw r;return r},z=function(e,t,n,i){var s=e.length,l=i?i.length:0;if(!s||t.f&&!t.l)return n||new r(0);var h=!n,d=h||2!=t.i,f=t.i;h&&(n=new r(3*s));var m=function(e){var t=n.length;if(e>t){var i=new r(Math.max(2*t,e));i.set(n),n=i}},v=t.f||0,y=t.p||0,w=t.b||0,I=t.l,z=t.d,D=t.m,k=t.n,T=8*s;do{if(!I){v=E(e,y,1);var B=E(e,y+1,3);if(y+=3,!B){var R=e[(Q=F(y)+4)-4]|e[Q-3]<<8,$=Q+R;if($>s){f&&O(0);break}d&&m(w+R),n.set(e.subarray(Q,$),w),t.b=w+=R,t.p=y=8*$,t.f=v;continue}if(1==B)I=C,z=S,D=9,k=5;else if(2==B){var N=E(e,y,31)+257,P=E(e,y+10,15)+4,A=N+E(e,y+5,31)+1;y+=14;for(var U=new r(A),M=new r(19),H=0;H<P;++H)M[c[H]]=E(e,y+3*H,7);y+=3*P;var W=b(M),q=(1<<W)-1,G=p(M,W,1);for(H=0;H<A;){var Q,V=G[E(e,y,q)];if(y+=15&V,(Q=V>>4)<16)U[H++]=Q;else{var J=0,K=0;for(16==Q?(K=3+E(e,y,3),y+=2,J=U[H-1]):17==Q?(K=3+E(e,y,7),y+=3):18==Q&&(K=11+E(e,y,127),y+=7);K--;)U[H++]=J}}var j=U.subarray(0,N),Z=U.subarray(N);D=b(j),k=b(Z),I=p(j,D,1),z=p(Z,k,1)}else O(1);if(y>T){f&&O(0);break}}d&&m(w+131072);for(var X=(1<<D)-1,Y=(1<<k)-1,_=y;;_=y){var ee=(J=I[L(e,y)&X])>>4;if((y+=15&J)>T){f&&O(0);break}if(J||O(2),ee<256)n[w++]=ee;else{if(256==ee){_=y,I=null;break}var te=ee-254;if(ee>264){var ne=o[H=ee-257];te=E(e,y,(1<<ne)-1)+u[H],y+=ne}var re=z[L(e,y)&Y],ie=re>>4;re||O(3),y+=15&re;Z=g[ie];if(ie>3){ne=a[ie];Z+=L(e,y)&(1<<ne)-1,y+=ne}if(y>T){f&&O(0);break}d&&m(w+131072);var se=w+te;if(w<Z){var oe=l-Z,ae=Math.min(Z,se);for(oe+w<0&&O(3);w<ae;++w)n[w]=i[oe+w]}for(;w<se;++w)n[w]=n[w-Z]}}t.l=I,t.p=_,t.b=w,t.f=v,I&&(v=1,t.m=D,t.d=z,t.n=k)}while(!v);return w!=n.length&&h?x(n,0,w):n.subarray(0,w)},D=new r(0),k=function(e,t,n){for(var r=e(),i=e.toString(),s=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/\s+/g,"").split(","),o=0;o<r.length;++o){var a=r[o],c=s[o];if("function"==typeof a){t+=";"+c+"=";var l=a.toString();if(a.prototype)if(-1!=l.indexOf("[native code]")){var h=l.indexOf(" ",8)+1;t+=l.slice(h,l.indexOf("(",h))}else for(var u in t+=l,a.prototype)t+=";"+c+".prototype."+u+"="+a.prototype[u].toString();else t+=l}else n[c]=a}return t},T=[],B=function(e,t,r,i){if(!T[r]){for(var s="",o={},a=e.length-1,c=0;c<a;++c)s=k(e[c],s,o);T[r]={c:k(e[a],s,o),e:o}}var l=function(e,t){var n={};for(var r in e)n[r]=e[r];for(var r in t)n[r]=t[r];return n}({},T[r].e);return function(e,t,r,i,s){var o=new Worker(n[t]||(n[t]=URL.createObjectURL(new Blob([e+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return o.onmessage=function(e){var t=e.data,n=t.$e$;if(n){var r=new Error(n[0]);r.code=n[1],r.stack=n[2],s(r,null)}else s(null,t)},o.postMessage(r,i),o}(T[r].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",r,l,function(e){var t=[];for(var n in e)e[n].buffer&&t.push((e[n]=new e[n].constructor(e[n])).buffer);return t}(l),i)},R=function(){return[r,i,s,o,a,c,u,g,C,S,f,I,p,b,E,L,F,x,O,z,q,P,A]},$=function(){return[M,H]},N=function(){return[W]},P=function(e){return postMessage(e,[e.buffer])},A=function(e){return e&&{out:e.size&&new r(e.size),dictionary:e.dictionary}},U=function(e,t,n,r,i,s){var o=B(n,r,i,function(e,t){o.terminate(),s(e,t)});return o.postMessage([e,t],t.consume?[e.buffer]:[]),function(){o.terminate()}},M=function(e){31==e[0]&&139==e[1]&&8==e[2]||O(6,"invalid gzip data");var t=e[3],n=10;4&t&&(n+=2+(e[10]|e[11]<<8));for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[n++]);return n+(2&t)},H=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},W=function(e,t){return(8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31)&&O(6,"invalid zlib data"),(e[1]>>5&1)==+!t&&O(6,"invalid zlib data: "+(32&e[1]?"need":"unexpected")+" dictionary"),2+(e[1]>>3&4)};function q(e,t){return z(e,{i:2},t&&t.out,t&&t.dictionary)}function G(e,t){var n=M(e);return n+8>e.length&&O(6,"invalid gzip data"),z(e.subarray(n,-8),{i:2},t&&t.out||new r(H(e)),t&&t.dictionary)}function Q(e,t){return z(e.subarray(W(e,t&&t.dictionary),-4),{i:2},t&&t.out,t&&t.dictionary)}function V(e,t,n){return n||(n=t,t={}),"function"!=typeof n&&O(7),31==e[0]&&139==e[1]&&8==e[2]?function(e,t,n){return n||(n=t,t={}),"function"!=typeof n&&O(7),U(e,t,[R,$,function(){return[G]}],function(e){return P(G(e.data[0],e.data[1]))},3,n)}(e,t,n):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?function(e,t,n){return n||(n=t,t={}),"function"!=typeof n&&O(7),U(e,t,[R],function(e){return P(q(e.data[0],A(e.data[1])))},1,n)}(e,t,n):function(e,t,n){return n||(n=t,t={}),"function"!=typeof n&&O(7),U(e,t,[R,N,function(){return[Q]}],function(e){return P(Q(e.data[0],A(e.data[1])))},5,n)}(e,t,n)}var J="undefined"!=typeof TextDecoder&&new TextDecoder;try{J.decode(D,{stream:!0})}catch(te){}class K{constructor(){this.decoder=new TextDecoder}async decompress(e){return new Promise((t,n)=>{try{V(e,(e,r)=>{e?n(new Error(`Decompression failed: ${e.message}`)):t(r)})}catch(r){n(new Error(`Decompression error: ${r}`))}})}async decompressZstd(e){throw new Error("Zstd decompression not implemented yet")}isCompressionSupported(e){switch(e.toLowerCase()){case"gzip":case"deflate":return!0;default:return!1}}async decompressGzip(e){return new Promise((t,n)=>{V(e,(e,r)=>{e?n(new Error(`Gzip decompression failed: ${e.message}`)):t(r)})})}getStats(){return{totalDecompressions:0,totalInputBytes:0,totalOutputBytes:0,averageCompressionRatio:1}}}class j extends e{constructor(e,n){super(),this.reconnectAttempts=0,this.currentQuality="medium",this.isConnected=!1,this.isPaused=!1,this.stats={fps:0,latency:0,droppedFrames:0,totalFrames:0},this.fpsCounter={frames:0,lastTime:Date.now(),currentFPS:0},this.config=e,this.logger=n,this.frameBuffer=new t(e.getBufferSize()),this.decompressor=new K,this.setupStatsTracking()}async connect(){if(!this.isConnected&&this.ws?.readyState!==WebSocket.CONNECTING)try{this.logger.info(`Connecting to ${this.config.getServerUrl()}`),this.ws=new WebSocket(this.config.getServerUrl()),this.ws.binaryType="arraybuffer",this.setupWebSocketHandlers(),await this.waitForConnection()}catch(e){throw this.logger.error("Connection failed:",e),this.handleConnectionError(e),e}}setupWebSocketHandlers(){this.ws&&(this.ws.onopen=()=>{this.logger.info("WebSocket connected"),this.isConnected=!0,this.reconnectAttempts=0,this.startHeartbeat(),this.emit("connected",void 0)},this.ws.onclose=e=>{this.logger.warning(`WebSocket closed: ${e.code} - ${e.reason}`),this.handleDisconnection()},this.ws.onerror=e=>{this.logger.error("WebSocket error:",e),this.handleConnectionError(new Error("WebSocket error"))},this.ws.onmessage=e=>{this.isPaused||this.handleMessage(e.data)})}async waitForConnection(){return new Promise((e,t)=>{if(!this.ws)return void t(new Error("WebSocket not initialized"));const n=setTimeout(()=>{t(new Error("Connection timeout"))},1e4);this.ws.addEventListener("open",()=>{clearTimeout(n),e()}),this.ws.addEventListener("error",()=>{clearTimeout(n),t(new Error("Connection failed"))})})}handleMessage(e){try{const t=this.parseFrameMessage(e);t&&this.processFrame(t.header,t.payload)}catch(t){this.logger.error("Error processing frame:",t)}}parseFrameMessage(e){const t=new DataView(e);if(e.byteLength<4)return this.logger.warning("Frame message too short"),null;const n=t.getUint32(0,!0);if(e.byteLength<4+n)return this.logger.warning("Invalid frame message format"),null;const r=e.slice(4,4+n),i=(new TextDecoder).decode(r);try{const t=JSON.parse(i),r=e.slice(4+n);return t.latency=Date.now()-t.timestamp,{header:t,payload:r}}catch(s){return this.logger.error("Failed to parse frame header:",s),null}}async processFrame(e,t){try{this.stats.totalFrames++,this.updateFPS();const n=new Uint8Array(t),r=e.width*e.height*4;if(n.length!==r)return void this.logger.warning(`Frame size mismatch: expected ${r}, got ${n.length}`);const i=new ImageData(new Uint8ClampedArray(n),e.width,e.height);this.frameBuffer.addFrame({imageData:i,metadata:e,timestamp:Date.now()});const s=this.frameBuffer.getLatestFrame();s&&this.emit("frame",{data:s.imageData,metadata:s.metadata})}catch(n){this.logger.error("Error processing frame:",n),this.stats.droppedFrames++}}updateFPS(){this.fpsCounter.frames++;const e=Date.now();e-this.fpsCounter.lastTime>=1e3&&(this.fpsCounter.currentFPS=this.fpsCounter.frames,this.fpsCounter.frames=0,this.fpsCounter.lastTime=e,this.stats.fps=this.fpsCounter.currentFPS)}setupStatsTracking(){this.statsTimer=window.setInterval(()=>{if(this.isConnected){const e=this.frameBuffer.getLatestFrame();e&&(this.stats.latency=e.metadata.latency||0),this.emit("stats",{...this.stats})}},1e3)}startHeartbeat(){this.heartbeatTimer=window.setInterval(()=>{this.ws?.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({type:"ping"}))},this.config.getHeartbeatInterval())}handleDisconnection(){this.isConnected=!1,this.stopHeartbeat(),this.emit("disconnected",void 0),this.reconnectAttempts<this.config.getReconnectAttempts()&&this.scheduleReconnect()}handleConnectionError(e){this.isConnected=!1,this.emit("error",e),this.reconnectAttempts<this.config.getReconnectAttempts()&&this.scheduleReconnect()}scheduleReconnect(){this.reconnectAttempts++;const e=this.config.getReconnectDelay()*Math.pow(2,this.reconnectAttempts-1);this.logger.info(`Scheduling reconnect attempt ${this.reconnectAttempts} in ${e}ms`),this.reconnectTimer=window.setTimeout(()=>{this.connect().catch(e=>{this.logger.error("Reconnection failed:",e)})},e)}stopHeartbeat(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0)}disconnect(){this.logger.info("Disconnecting from stream server"),this.isConnected=!1,this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=void 0),this.stopHeartbeat(),this.statsTimer&&(clearInterval(this.statsTimer),this.statsTimer=void 0),this.ws&&(this.ws.close(1e3,"Client disconnect"),this.ws=void 0),this.emit("disconnected",void 0)}pause(){this.isPaused=!0,this.logger.debug("Stream paused")}resume(){this.isPaused=!1,this.logger.debug("Stream resumed")}setQuality(e){if(this.currentQuality=e,this.ws?.readyState===WebSocket.OPEN){const t=this.config.getQuality(e);this.ws.send(JSON.stringify({type:"quality",config:t}))}}getCurrentFPS(){return this.fpsCounter.currentFPS}getStats(){return{...this.stats}}isConnectedState(){return this.isConnected}}class Z extends e{constructor(e){super(),this.currentScale=1,this.isFullscreen=!1,this.logger=e}async initialize(){this.logger.info("Initializing UI controller..."),await this.setupDOMElements(),this.setupEventHandlers(),this.setupCanvas(),this.logger.info("UI controller initialized")}async setupDOMElements(){if("loading"===document.readyState&&await new Promise(e=>{document.addEventListener("DOMContentLoaded",e)}),this.canvas=document.getElementById("screen-canvas"),this.connectionStatus=document.getElementById("connection-status"),this.fpsCounter=document.getElementById("fps-counter"),this.latencyCounter=document.getElementById("latency-counter"),this.loadingOverlay=document.getElementById("loading-overlay"),this.errorOverlay=document.getElementById("error-overlay"),this.reconnectBtn=document.getElementById("reconnect-btn"),this.qualitySelect=document.getElementById("quality-select"),this.scaleSlider=document.getElementById("scale-slider"),this.scaleValue=document.getElementById("scale-value"),this.fullscreenBtn=document.getElementById("fullscreen-btn"),this.screenshotBtn=document.getElementById("screenshot-btn"),!this.canvas)throw new Error("Canvas element not found");if(this.ctx=this.canvas.getContext("2d"),!this.ctx)throw new Error("Failed to get 2D context")}setupEventHandlers(){this.reconnectBtn?.addEventListener("click",()=>{this.emit("reconnect",void 0),this.hideError()}),this.qualitySelect?.addEventListener("change",e=>{const t=e.target;this.emit("qualityChange",t.value)}),this.scaleSlider?.addEventListener("input",e=>{const t=e.target,n=parseFloat(t.value);this.setScale(n),this.emit("scaleChange",n)}),this.fullscreenBtn?.addEventListener("click",()=>{this.emit("fullscreen",void 0)}),this.screenshotBtn?.addEventListener("click",()=>{this.emit("screenshot",void 0)}),document.addEventListener("keydown",e=>{"F11"===e.code?(e.preventDefault(),this.emit("fullscreen",void 0)):e.ctrlKey&&"KeyS"===e.code&&(e.preventDefault(),this.emit("screenshot",void 0))}),document.addEventListener("fullscreenchange",()=>{this.isFullscreen=!!document.fullscreenElement,this.updateFullscreenButton()})}setupCanvas(){this.canvas&&(this.resizeCanvas(1280,720),window.addEventListener("resize",()=>{this.handleResize()}))}resizeCanvas(e,t){this.canvas&&(this.canvas.width=e,this.canvas.height=t,this.applyCanvasScale())}applyCanvasScale(){if(!this.canvas)return;const e=this.canvas.width*this.currentScale,t=this.canvas.height*this.currentScale;this.canvas.style.width=`${e}px`,this.canvas.style.height=`${t}px`}renderFrame(e,t){if(this.ctx&&this.canvas)try{this.canvas.width===t.width&&this.canvas.height===t.height||this.resizeCanvas(t.width,t.height),this.ctx.putImageData(e,0,0),this.loadingOverlay&&!this.loadingOverlay.classList.contains("hidden")&&this.loadingOverlay.classList.add("hidden")}catch(n){this.logger.error("Error rendering frame:",n)}}setConnectionStatus(e){if(!this.connectionStatus)return;this.connectionStatus.classList.remove("connected","connecting","error"),"disconnected"!==e&&this.connectionStatus.classList.add(e);this.connectionStatus.textContent={connected:"CONNECTED",connecting:"CONNECTING...",disconnected:"DISCONNECTED",error:"ERROR"}[e],"connecting"===e?this.showLoading():"connected"===e?(this.hideLoading(),this.hideError()):"error"===e?(this.hideLoading(),this.showError("Connection failed")):this.showLoading()}updateStats(e){this.fpsCounter&&(this.fpsCounter.textContent=e.fps.toString()),this.latencyCounter&&(this.latencyCounter.textContent=`${e.latency}ms`)}setScale(e){this.currentScale=e,this.applyCanvasScale(),this.scaleValue&&(this.scaleValue.textContent=`${Math.round(100*e)}%`),this.scaleSlider&&(this.scaleSlider.value=e.toString())}toggleFullscreen(){document.fullscreenElement?document.exitFullscreen().catch(e=>{this.logger.error("Error attempting to exit fullscreen:",e)}):document.documentElement.requestFullscreen().catch(e=>{this.logger.error("Error attempting to enable fullscreen:",e)})}takeScreenshot(){if(this.canvas)try{const e=document.createElement("a");e.download=`screenshot-${Date.now()}.png`,e.href=this.canvas.toDataURL(),e.click(),this.logger.info("Screenshot saved")}catch(e){this.logger.error("Failed to take screenshot:",e)}}handleResize(){this.applyCanvasScale()}showLoading(){this.loadingOverlay&&this.loadingOverlay.classList.remove("hidden")}hideLoading(){this.loadingOverlay&&this.loadingOverlay.classList.add("hidden")}showError(e){if(this.errorOverlay){this.errorOverlay.classList.remove("hidden");const t=this.errorOverlay.querySelector(".error-text");t&&(t.textContent=e.toUpperCase())}}hideError(){this.errorOverlay&&this.errorOverlay.classList.add("hidden")}updateFullscreenButton(){this.fullscreenBtn&&(this.fullscreenBtn.textContent=this.isFullscreen?"EXIT FULL":"FULLSCREEN")}getCanvas(){return this.canvas}getCurrentScale(){return this.currentScale}isInFullscreen(){return this.isFullscreen}}var X=(e=>(e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR",e))(X||{});class Y{constructor(){this.logs=[],this.maxLogs=100,this.logLevel=1,this.setupLogContainer()}setupLogContainer(){const e=()=>{this.logContainer=document.getElementById("log-container")};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}log(e,t,n){const r={timestamp:new Date,level:e,message:t,data:n};if(this.logs.push(r),this.logs.length>this.maxLogs&&this.logs.shift(),e>=this.logLevel){const i=`[${r.timestamp.toLocaleTimeString()}] ${X[e]}: ${t}`;switch(e){case 0:console.debug(i,n);break;case 1:console.info(i,n);break;case 2:console.warn(i,n);break;case 3:console.error(i,n)}}this.updateLogDisplay(r)}updateLogDisplay(e){if(!this.logContainer)return;const t=document.createElement("div");t.className=`log-entry ${X[e.level].toLowerCase()}`;const n=e.timestamp.toLocaleTimeString(),r=this.getLogPrefix(e.level);for(t.textContent=`${n} ${r} ${e.message}`,this.logContainer.appendChild(t);this.logContainer.children.length>50;)this.logContainer.removeChild(this.logContainer.firstChild);this.logContainer.scrollTop=this.logContainer.scrollHeight}getLogPrefix(e){switch(e){case 0:return"[DBG]";case 1:return"[INF]";case 2:return"[WRN]";case 3:return"[ERR]";default:return"[LOG]"}}debug(e,t){this.log(0,e,t)}info(e,t){this.log(1,e,t)}warning(e,t){this.log(2,e,t)}error(e,t){this.log(3,e,t)}setLogLevel(e){this.logLevel=e}getLogs(){return[...this.logs]}clearLogs(){this.logs=[],this.logContainer&&(this.logContainer.innerHTML='<div class="log-entry">> System initialized</div>')}}class _{constructor(){this.config=this.getDefaultConfig(),this.loadFromEnvironment()}getDefaultConfig(){return{serverUrl:this.createServerUrl(),reconnectAttempts:5,reconnectDelay:2e3,heartbeatInterval:3e4,bufferSize:3,qualitySettings:{high:{maxWidth:1920,maxHeight:1080,targetFPS:30,compressionLevel:1},medium:{maxWidth:1280,maxHeight:720,targetFPS:24,compressionLevel:3},low:{maxWidth:854,maxHeight:480,targetFPS:15,compressionLevel:6}}}}createServerUrl(){return`${"https:"===window.location.protocol?"wss:":"ws:"}//${window.location.hostname}:8080/stream`}loadFromEnvironment(){const e=new URLSearchParams(window.location.search);e.has("server")&&(this.config.serverUrl=e.get("server")),e.has("quality")}get(){return this.config}getQuality(e){return this.config.qualitySettings[e]}getServerUrl(){return this.config.serverUrl}getReconnectAttempts(){return this.config.reconnectAttempts}getReconnectDelay(){return this.config.reconnectDelay}getHeartbeatInterval(){return this.config.heartbeatInterval}getBufferSize(){return this.config.bufferSize}}class ee{constructor(){this.config=new _,this.logger=new Y,this.uiController=new Z(this.logger),this.streamClient=new j(this.config,this.logger),this.initialize()}async initialize(){this.logger.info("Initializing RetroStream application...");try{await this.uiController.initialize(),this.setupEventHandlers(),await this.connect(),this.logger.info("Application initialized successfully")}catch(e){this.logger.error("Failed to initialize application:",e),this.uiController.showError("Initialization failed")}}setupEventHandlers(){this.streamClient.on("connected",()=>{this.uiController.setConnectionStatus("connected"),this.logger.info("Connected to stream server")}),this.streamClient.on("disconnected",()=>{this.uiController.setConnectionStatus("disconnected"),this.logger.warning("Disconnected from stream server")}),this.streamClient.on("error",e=>{this.uiController.setConnectionStatus("error"),this.uiController.showError("Connection error"),this.logger.error("Stream error:",e)}),this.streamClient.on("frame",e=>{this.uiController.renderFrame(e.data,e.metadata),this.uiController.updateStats({fps:this.streamClient.getCurrentFPS(),latency:e.metadata.latency||0})}),this.uiController.on("reconnect",()=>{this.connect()}),this.uiController.on("qualityChange",e=>{this.streamClient.setQuality(e),this.logger.info(`Quality changed to: ${e}`)}),this.uiController.on("scaleChange",e=>{this.uiController.setScale(e),this.logger.info(`Scale changed to: ${e}x`)}),this.uiController.on("fullscreen",()=>{this.uiController.toggleFullscreen()}),this.uiController.on("screenshot",()=>{this.uiController.takeScreenshot(),this.logger.info("Screenshot captured")}),document.addEventListener("visibilitychange",()=>{document.hidden?this.streamClient.pause():this.streamClient.resume()}),window.addEventListener("resize",()=>{this.uiController.handleResize()}),window.addEventListener("beforeunload",()=>{this.streamClient.disconnect()})}async connect(){try{this.uiController.setConnectionStatus("connecting"),this.logger.info("Attempting to connect to stream server..."),await this.streamClient.connect()}catch(e){this.logger.error("Failed to connect:",e),this.uiController.setConnectionStatus("error"),this.uiController.showError("Failed to connect to server")}}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>new ee):new ee;
//# sourceMappingURL=index-BAkYhfhJ.js.map
